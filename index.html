<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁæäÊØõÂä©Êâã v4.5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .version {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #fff;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-family: 'Courier New', monospace;
            resize: vertical;
            line-height: 1.5;
        }

        textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .file-upload {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .file-option {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            text-align: center;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .file-option:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .output {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            min-height: 150px;
            font-family: 'Courier New', monospace;
            color: white;
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.5;
            overflow-y: auto;
            max-height: 300px;
        }

        .buttons {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 100px;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-icon {
            font-size: 1.2rem;
        }

        .btn-blue { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .btn-green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .btn-yellow { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .btn-purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .btn-red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }

        .progress-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            display: none;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            height: 8px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #10b981, #3b82f6);
            height: 100%;
            width: 0%;
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .log-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .log-item {
            margin: 2px 0;
            padding: 2px 0;
        }

        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-warning { color: #f59e0b; }
        .log-info { color: #3b82f6; }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .note {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .note a {
            color: #93c5fd;
            text-decoration: none;
        }

        .note a:hover {
            text-decoration: underline;
        }

        /* ËØ≠Ê≥ïÈ´ò‰∫ÆÊ†∑Âºè */
        .hljs-keyword { color: #c678dd; }
        .hljs-string { color: #98c379; }
        .hljs-number { color: #d19a66; }
        .hljs-comment { color: #5c6370; font-style: italic; }
        .hljs-function { color: #61afef; }
        .hljs-property { color: #e06c75; }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .buttons {
                gap: 8px;
            }
            
            .btn {
                min-width: 80px;
                padding: 10px 12px;
                font-size: 0.8rem;
            }
            
            .btn-icon {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ê†áÈ¢ò -->
        <div class="header">
            <div class="title">ÁæäÊØõÂä©Êâã</div>
            <span class="version">v4.3</span>
        </div>

        <!-- ÈÖçÁΩÆÂå∫Âüü -->
        <div class="section">
            <div class="section-title">‚öôÔ∏è GitHub ÈÖçÁΩÆ</div>
            <div class="input-group">
                <label for="token">GitHub Token</label>
                <input type="password" id="token" placeholder="ËØ∑ËæìÂÖ• GitHub Personal Access Token">
            </div>
            <div class="input-group">
                <label for="repo">‰ªìÂ∫ìÂú∞ÂùÄ</label>
                <input type="text" id="repo" placeholder="Áî®Êà∑Âêç/‰ªìÂ∫ìÂêç (‰æãÂ¶Ç: username/repo)">
            </div>
        </div>

        <!-- ‰ª£Á†ÅËæìÂÖ• -->
        <div class="section">
            <div class="section-title">üìù ÂØÜÊñáËæìÂÖ•</div>
            <textarea id="input" placeholder="ËØ∑Á≤òË¥¥ÈúÄË¶ÅËß£ÂØÜÁöÑÂØÜÊñá‰ª£Á†Å...

ÊîØÊåÅÁöÑÂä†ÂØÜÁ±ªÂûãÔºö
- JavaScript Ê∑∑Ê∑Ü‰ª£Á†Å
- Base64 ÁºñÁ†Å
- URL ÁºñÁ†Å
- ÂÖ∂‰ªñÂ∏∏ËßÅÂä†ÂØÜÊ†ºÂºè"></textarea>
            
            <div class="file-upload">
                <input type="file" id="fileInput" style="display: none;" accept=".js,.txt,.json" onchange="handleFileUpload(event)">
                <div class="file-option" onclick="document.getElementById('fileInput').click()">
                    üìÅ<br>ÈÄâÊã©Êñá‰ª∂
                </div>
                <div class="file-option" onclick="clearInput()">
                    üóë<br>Ê∏ÖÁ©∫
                </div>
            </div>
            
            <div class="input-group" style="margin-top: 15px;">
                <label for="remoteUrl">ÊàñËæìÂÖ•ËøúÁ®ãÊñá‰ª∂ URL</label>
                <input type="url" id="remoteUrl" placeholder="https://example.com/encrypted.js">
                <div class="file-upload" style="margin-top: 8px;">
                    <div class="file-option" onclick="loadRemoteFile()">
                        üåê<br>Âä†ËΩΩËøúÁ®ãÊñá‰ª∂
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊéßÂà∂ÊåâÈíÆ -->
        <div class="buttons">
            <button class="btn btn-blue" onclick="startDecrypt()">
                <span class="btn-icon">üîì</span>
                <span>Ëß£ÂØÜ</span>
            </button>
            <button class="btn btn-green" onclick="getResult()">
                <span class="btn-icon">üì•</span>
                <span>ËØªÂèñ</span>
            </button>
            <button class="btn btn-yellow" onclick="copyResult()">
                <span class="btn-icon">üìã</span>
                <span>Â§çÂà∂</span>
            </button>
            <button class="btn btn-purple" onclick="downloadResult()">
                <span class="btn-icon">üíæ</span>
                <span>‰∏ãËΩΩ</span>
            </button>
            <button class="btn btn-red" onclick="clearAll()">
                <span class="btn-icon">üóë</span>
                <span>Ê∏ÖÈô§</span>
            </button>
        </div>

        <!-- ËøõÂ∫¶Êù° -->
        <div id="progressContainer" class="progress-container">
            <div style="margin-bottom: 5px;">Ëß£ÂØÜËøõÂ∫¶</div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
        </div>

        <!-- ËæìÂá∫ÁªìÊûú -->
        <div class="section">
            <div class="section-title">‚ú® Ëß£ÂØÜÁªìÊûú</div>
            <div id="output" class="output">// Ëß£ÂØÜÁªìÊûúÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå...</div>
        </div>

        <!-- ÊâßË°åÊó•Âøó -->
        <div class="section">
            <div class="section-title">üìã ÊâßË°åÊó•Âøó</div>
            <div id="log" class="log-container"></div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        window.appData = {
            token: localStorage.getItem('github_token') || '',
            repo: localStorage.getItem('repo_name') || '',
            checkTimer: null,
            isChecking: false
        };

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÊÅ¢Â§çÈÖçÁΩÆ
            if (window.appData.token) {
                document.getElementById('token').value = window.appData.token;
            }
            if (window.appData.repo) {
                document.getElementById('repo').value = window.appData.repo;
            }

            // ÁªëÂÆöÈÖçÁΩÆ‰øùÂ≠ò‰∫ã‰ª∂
            document.getElementById('token').addEventListener('input', function() {
                window.appData.token = this.value;
                localStorage.setItem('github_token', this.value);
            });

            document.getElementById('repo').addEventListener('input', function() {
                window.appData.repo = this.value;
                localStorage.setItem('repo_name', this.value);
            });

            addLog('Á≥ªÁªüÂàùÂßãÂåñÂÆåÊàê v4.3', 'success');
        });

        // ÊòæÁ§∫ToastÈÄöÁü•
        function showToast(message, duration = 3000) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, duration);
        }

        // Ê∑ªÂä†Êó•Âøó
        function addLog(message, type = 'info') {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logItem = document.createElement('div');
            logItem.className = `log-item log-${type}`;
            logItem.textContent = `${timestamp} ${message}`;
            log.appendChild(logItem);
            log.scrollTop = log.scrollHeight;
        }

        // ËÆæÁΩÆËøõÂ∫¶
        function setProgress(percent) {
            const container = document.getElementById('progressContainer');
            const fill = document.getElementById('progressFill');
            
            if (percent > 0) {
                container.style.display = 'block';
                fill.style.width = percent + '%';
            } else {
                container.style.display = 'none';
                fill.style.width = '0%';
            }
        }

        // Êñá‰ª∂‰∏ä‰º†Â§ÑÁêÜ
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            addLog('ÂºÄÂßãËØªÂèñÊñá‰ª∂: ' + file.name, 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('input').value = e.target.result;
                addLog('Êñá‰ª∂ËØªÂèñÊàêÂäü', 'success');
                showToast('Êñá‰ª∂Â∑≤Âä†ËΩΩ');
            };
            reader.onerror = function() {
                addLog('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•', 'error');
                showToast('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•');
            };
            reader.readAsText(file);
        }

        // Âä†ËΩΩËøúÁ®ãÊñá‰ª∂
        function loadRemoteFile() {
            const url = document.getElementById('remoteUrl').value.trim();
            if (!url) {
                showToast('ËØ∑ËæìÂÖ•ËøúÁ®ãÊñá‰ª∂URL');
                return;
            }

            addLog('Ê≠£Âú®Âä†ËΩΩËøúÁ®ãÊñá‰ª∂...', 'info');
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•');
                    }
                    return response.text();
                })
                .then(content => {
                    document.getElementById('input').value = content;
                    addLog('ËøúÁ®ãÊñá‰ª∂Âä†ËΩΩÊàêÂäü', 'success');
                    showToast('ËøúÁ®ãÊñá‰ª∂Â∑≤Âä†ËΩΩ');
                })
                .catch(error => {
                    addLog('ËøúÁ®ãÊñá‰ª∂Âä†ËΩΩÂ§±Ë¥•: ' + error.message, 'error');
                    showToast('ËøúÁ®ãÊñá‰ª∂Âä†ËΩΩÂ§±Ë¥•');
                });
        }

        // Ê∏ÖÁ©∫ËæìÂÖ•
        function clearInput() {
            document.getElementById('input').value = '';
            document.getElementById('remoteUrl').value = '';
            showToast('ËæìÂÖ•Â∑≤Ê∏ÖÁ©∫');
            addLog('Ê∏ÖÁ©∫ËæìÂÖ•ÂÜÖÂÆπ', 'info');
        }

        // Êô∫ËÉΩÈ¢ÑÂ§ÑÁêÜÂØÜÊñá
        function preprocessCiphertext(input) {
            addLog('ÂºÄÂßãÊô∫ËÉΩÈ¢ÑÂ§ÑÁêÜÂØÜÊñá...', 'info');
            
            // ÂéªÈô§Ê≥®ÈáäÂíåÂ§ö‰ΩôÂÜÖÂÆπ
            let processed = input
                // ÁßªÈô§ÂçïË°åÊ≥®Èáä
                .replace(/\/\/.*$/gm, '')
                // ÁßªÈô§Â§öË°åÊ≥®Èáä
                .replace(/\/\*[\s\S]*?\*\//g, '')
                // ÁßªÈô§HTMLÊ≥®Èáä
                .replace(/<!--[\s\S]*?-->/g, '')
                // ÁßªÈô§Êó∂Èó¥Êà≥Ë°å
                .replace(/^\s*\/\/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.*$/gm, '')
                // ÁßªÈô§Ëß£ÂØÜËÑöÊú¨ËØ¥ÊòéË°å
                .replace(/^\s*\/\/Ëß£ÂØÜËÑöÊú¨.*$/gm, '')
                // ÁßªÈô§ÂÖ∂‰ªñËØ¥ÊòéÊÄßÊñáÂ≠ó
                .replace(/^\s*\/\/.*?(Ëß£ÂØÜ|ËÑöÊú¨|ËØ¥Êòé|Ê≥®Èáä).*$/gm, '')
                // ÁßªÈô§Á©∫Ë°å
                .replace(/^\s*[\r\n]/gm, '')
                // ÁßªÈô§Ë°åÈ¶ñÁ©∫ÁôΩ
                .replace(/^\s+/gm, '')
                // ÂêàÂπ∂ËøûÁª≠ÁöÑÁ©∫ÁôΩÂ≠óÁ¨¶
                .replace(/\s+/g, ' ')
                .trim();

            addLog('ÂØÜÊñáÈ¢ÑÂ§ÑÁêÜÂÆåÊàê', 'success');
            return processed;
        }

        // Êèê‰∫§ÂØÜÊñáÂà∞GitHub
        async function submitCode(code) {
            addLog('Êèê‰∫§ÂØÜÊñáÂà∞ GitHub input.js...', 'info');
            
            const url = `https://api.github.com/repos/${window.appData.repo}/contents/input.js`;
            
            // Ê£ÄÊü•Êñá‰ª∂ÊòØÂê¶Â≠òÂú®
            let sha = null;
            try {
                const checkResp = await fetch(url, {
                    headers: {
                        'Authorization': `token ${window.appData.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (checkResp.ok) {
                    const data = await checkResp.json();
                    sha = data.sha;
                    addLog('Ê£ÄÊµãÂà∞Â∑≤Â≠òÂú®ÁöÑ input.jsÔºåÂ∞ÜÊõ¥Êñ∞', 'info');
                }
            } catch (e) {
                addLog('Â∞ÜÂàõÂª∫Êñ∞ÁöÑ input.js Êñá‰ª∂', 'info');
            }
            
            // Êèê‰∫§Êñá‰ª∂
            const payload = {
                message: `Update input.js - ${new Date().toISOString()}`,
                content: btoa(unescape(encodeURIComponent(code))),
                branch: 'main'
            };
            
            if (sha) payload.sha = sha;
            
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${window.appData.token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`GitHub API ÈîôËØØ: ${error.message}`);
            }
            
            addLog('ÂØÜÊñáÂ∑≤Êèê‰∫§Âà∞ input.jsÔºåActions Âç≥Â∞ÜËá™Âä®Ëß¶ÂèëËß£ÂØÜ...', 'success');
        }

        // Á≠âÂæÖËß£ÂØÜÁªìÊûú
        async function waitForResult() {
            addLog('Actions ÊâßË°å‰∏≠... (60Áßí)', 'info');
            setProgress(10);
            
            let attempts = 0;
            const maxAttempts = 12; // 60ÁßíÔºåÊØè5ÁßíÊ£ÄÊü•‰∏ÄÊ¨°
            
            while (attempts < maxAttempts) {
                await new Promise(resolve => setTimeout(resolve, 5000));
                attempts++;
                
                const progress = 10 + (attempts / maxAttempts) * 80;
                setProgress(progress);
                
                try {
                    if (await tryGetResult()) {
                        return;
                    }
                } catch (error) {
                    addLog('Ê£ÄÊü•ÁªìÊûúÊó∂Âá∫Èîô: ' + error.message, 'warning');
                }
            }
            
            addLog('Á≠âÂæÖ60ÁßíË∂ÖÊó∂ÔºåÂ∞ùËØïËé∑ÂèñÁªìÊûú...', 'warning');
            setProgress(100);
            
            // ÊúÄÂêéÂ∞ùËØïËé∑ÂèñÁªìÊûú
            try {
                await tryGetResult();
            } catch (error) {
                addLog('Ëé∑ÂèñÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
                showTimeoutHelp();
            }
            
            setProgress(0);
        }

        // Â∞ùËØïËé∑ÂèñÁªìÊûú
        async function tryGetResult() {
            addLog('Ê≠£Âú®Ëé∑ÂèñËß£ÂØÜÁªìÊûú...', 'info');
            
            // ÊñπÊ≥ï1: GitHub API
            try {
                addLog('Â∞ùËØïGitHub API...', 'info');
                const response = await fetch(`https://api.github.com/repos/${window.appData.repo}/contents/output.js`, {
                    headers: {
                        'Authorization': `token ${window.appData.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const content = decodeURIComponent(escape(atob(data.content)));
                    
                    if (content && content.trim().length > 10) {
                        displayResult(content);
                        addLog('GitHub APIËé∑ÂèñÊàêÂäüÔºÅ', 'success');
                        showToast('Ëß£ÂØÜÊàêÂäüÔºÅ');
                        setProgress(0);
                        
                        // ÊªöÂä®Âà∞ÁªìÊûúÂå∫Âüü
                        document.getElementById('output').scrollIntoView({ behavior: 'smooth', block: 'center' });
                        return true;
                    }
                }
            } catch (error) {
                addLog('GitHub APIÂ§±Ë¥•: ' + error.message, 'error');
            }
            
            // ÊñπÊ≥ï2: Raw URL
            try {
                addLog('Â∞ùËØïRaw URL...', 'info');
                const response = await fetch(`https://raw.githubusercontent.com/${window.appData.repo}/main/output.js?t=${Date.now()}`);
                
                if (response.ok) {
                    const content = await response.text();
                    
                    if (content && content.trim().length > 10) {
                        displayResult(content);
                        addLog('Raw URLËé∑ÂèñÊàêÂäüÔºÅ', 'success');
                        showToast('Ëß£ÂØÜÊàêÂäüÔºÅ');
                        setProgress(0);
                        
                        // ÊªöÂä®Âà∞ÁªìÊûúÂå∫Âüü
                        document.getElementById('output').scrollIntoView({ behavior: 'smooth', block: 'center' });
                        return true;
                    }
                }
            } catch (error) {
                addLog('Raw URLÂ§±Ë¥•: ' + error.message, 'error');
            }
            
            // ÊñπÊ≥ï3: ‰ª£ÁêÜËé∑Âèñ
            try {
                addLog('Â∞ùËØï‰ª£ÁêÜËé∑Âèñ...', 'info');
                const response = await fetch(`https://cors-anywhere.herokuapp.com/https://raw.githubusercontent.com/${window.appData.repo}/main/output.js?t=${Date.now()}`);
                
                if (response.ok) {
                    const content = await response.text();
                    
                    if (content && content.trim().length > 10) {
                        displayResult(content);
                        addLog('‰ª£ÁêÜËé∑ÂèñÊàêÂäüÔºÅ', 'success');
                        showToast('Ëß£ÂØÜÊàêÂäüÔºÅ');
                        setProgress(0);
                        
                        // ÊªöÂä®Âà∞ÁªìÊûúÂå∫Âüü
                        document.getElementById('output').scrollIntoView({ behavior: 'smooth', block: 'center' });
                        return true;
                    }
                }
            } catch (error) {
                addLog('‰ª£ÁêÜËé∑ÂèñÂ§±Ë¥•: ' + error.message, 'error');
            }
            
            return false;
        }

        // ÊòæÁ§∫Ë∂ÖÊó∂Â∏ÆÂä©
        function showTimeoutHelp() {
            const helpText = `// ‚è∞ Á≠âÂæÖ60ÁßíË∂ÖÊó∂
//
// üîÑ GitHub Actions ÂèØËÉΩ‰ªçÂú®ÊâßË°åËß£ÂØÜ‰∏≠ÔºåËØ∑Â∞ùËØï:
//
// 1Ô∏è‚É£ ÁÇπÂáª "üì• ËØªÂèñ" ÊåâÈíÆÊâãÂä®Ëé∑ÂèñËß£ÂØÜÁªìÊûú
// 2Ô∏è‚É£ ËÆøÈóÆGitHubÊü•Áúã: https://github.com/${window.appData.repo}/blob/main/output.js
// 3Ô∏è‚É£ Ê£ÄÊü•ActionsÁä∂ÊÄÅ: https://github.com/${window.appData.repo}/actions
// 4Ô∏è‚É£ Êü•ÁúãÂØÜÊñáËæìÂÖ•: https://github.com/${window.appData.repo}/blob/main/input.js
//
// üí° ÊèêÁ§∫: 
// - Ëß£ÂØÜÊµÅÁ®ãÔºöÂØÜÊñá ‚Üí input.js ‚Üí ActionsËß£ÂØÜ ‚Üí output.js
// - Actions ÂèØËÉΩÈúÄË¶Å1-3ÂàÜÈíüÊâçËÉΩÂÆåÊàêËß£ÂØÜ`;
            
            displayResult(helpText);
            addLog('ÊòæÁ§∫Ë∂ÖÊó∂Â∏ÆÂä©‰ø°ÊÅØ', 'warning');
            showToast('Ë∂ÖÊó∂‰∫ÜÔºÅËØ∑ÁÇπÂáª"üì• ËØªÂèñ"ÊåâÈíÆÊâãÂä®Ëé∑ÂèñÁªìÊûú', 5000);
        }

        // ÁÆÄÂçïÁöÑËØ≠Ê≥ïÈ´ò‰∫Æ
        function highlightJS(code) {
            return code
                // ÂÖàËΩ¨‰πâHTMLÂ≠óÁ¨¶ÔºåÈÅøÂÖçXSS
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;')
                // ÁÑ∂ÂêéÂ∫îÁî®ËØ≠Ê≥ïÈ´ò‰∫Æ
                .replace(/\b(function|var|let|const|if|else|for|while|do|switch|case|break|continue|return|try|catch|finally|throw|new|this|typeof|instanceof|in|of|class|extends|import|export|default|async|await|yield|true|false|null|undefined)\b/g, '<span class="hljs-keyword">$1</span>')
                // Â≠óÁ¨¶‰∏≤ - ‰øÆÊ≠£Ê≠£ÂàôË°®ËææÂºè
                .replace(/(&#39;|&quot;)(.*?)\1/g, '<span class="hljs-string">$1$2$1</span>')
                // Êï∞Â≠ó
                .replace(/\b(\d+\.?\d*)\b/g, '<span class="hljs-number">$1</span>')
                // Ê≥®Èáä - ÂçïË°åÊ≥®Èáä
                .replace(/\/\/.*$/gm, '<span class="hljs-comment">$&</span>')
                // Ê≥®Èáä - Â§öË°åÊ≥®Èáä
                .replace(/\/\*[\s\S]*?\*\//g, '<span class="hljs-comment">$&</span>')
                // ÂáΩÊï∞Âêç
                .replace(/\b([a-zA-Z_$][a-zA-Z0-9_$]*)\s*(?=\()/g, '<span class="hljs-function">$1</span>')
                // Â±ûÊÄß
                .replace(/\.([a-zA-Z_$][a-zA-Z0-9_$]*)/g, '.<span class="hljs-property">$1</span>');
        }

        // ÁßªÈô§HTMLÊ†áÁ≠æÔºàÁî®‰∫éÂ§çÂà∂Âíå‰∏ãËΩΩÔºâ
        function stripHTMLTags(html) {
            const div = document.createElement('div');
            div.innerHTML = html;
            return div.textContent || div.innerText || '';
        }

        // ÊòæÁ§∫ÁªìÊûúÔºàÂ∏¶ËØ≠Ê≥ïÈ´ò‰∫ÆÔºâ
        function displayResult(content) {
            const output = document.getElementById('output');
            
            if (!content || content.includes('Ëß£ÂØÜÁªìÊûúÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå')) {
                output.innerHTML = '<span class="hljs-comment">// Ëß£ÂØÜÁªìÊûúÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå...</span>';
                return;
            }
            
            // Ê∏ÖÁêÜÂèØËÉΩÂ≠òÂú®ÁöÑHTMLÊ†áÁ≠æÊÆãÁïô
            content = content.replace(/<span class="hljs-[^"]*">/g, '').replace(/<\/span>/g, '');
            
            // Âà§Êñ≠ÊòØÂê¶‰∏∫‰ª£Á†ÅÂπ∂Â∫îÁî®ËØ≠Ê≥ïÈ´ò‰∫Æ
            if (content.includes('function') || content.includes('var ') || content.includes('let ') || content.includes('const ') || content.includes('{') || content.includes('}')) {
                output.innerHTML = highlightJS(content);
            } else {
                output.textContent = content;
            }
        }

        // ÂºÄÂßãËß£ÂØÜ
        async function startDecrypt() {
            const input = document.getElementById('input').value.trim();
            
            if (!input) {
                showToast('ËØ∑ÂÖàËæìÂÖ•ÈúÄË¶ÅËß£ÂØÜÁöÑÂØÜÊñá');
                return;
            }
            
            if (!window.appData.token || !window.appData.repo) {
                showToast('ËØ∑ÂÖàÈÖçÁΩÆ GitHub Token Âíå‰ªìÂ∫ìÂú∞ÂùÄ');
                return;
            }
            
            try {
                addLog('ÂºÄÂßãËß£ÂØÜÊµÅÁ®ã...', 'info');
                displayResult('');
                setProgress(0);
                
                // Êô∫ËÉΩÈ¢ÑÂ§ÑÁêÜÂØÜÊñá
                const processedInput = preprocessCiphertext(input);
                
                // ÊòæÁ§∫Â§ÑÁêÜÂâçÂêéÁöÑÂØπÊØî
                if (processedInput !== input) {
                    addLog(`ÂéüÂßãÈïøÂ∫¶: ${input.length} Â≠óÁ¨¶`, 'info');
                    addLog(`Â§ÑÁêÜÂêéÈïøÂ∫¶: ${processedInput.length} Â≠óÁ¨¶`, 'info');
                    addLog('Â∑≤Ëá™Âä®Ê∏ÖÁêÜÊ≥®ÈáäÂíåÂ§ö‰ΩôÂÜÖÂÆπ', 'success');
                }
                
                // Êèê‰∫§Â§ÑÁêÜÂêéÁöÑÂØÜÊñáÂà∞ input.js
                await submitCode(processedInput);
                
                // Á≠âÂæÖ Actions ÊâßË°åÂπ∂Ëé∑Âèñ output.js ÁªìÊûú
                await waitForResult();
                
            } catch (error) {
                addLog('Ëß£ÂØÜÂ§±Ë¥•: ' + error.message, 'error');
                showToast('Ëß£ÂØÜÂ§±Ë¥•: ' + error.message);
                setProgress(0);
            }
        }

        // ÊâãÂä®Ëé∑ÂèñÁªìÊûú
        async function getResult() {
            if (!window.appData.token || !window.appData.repo) {
                showToast('ËØ∑ÂÖàÈÖçÁΩÆ GitHub Token Âíå‰ªìÂ∫ìÂú∞ÂùÄ');
                return;
            }
            
            addLog('ÊâãÂä®Ëé∑ÂèñËß£ÂØÜÁªìÊûú...', 'info');
            
            try {
                const success = await tryGetResult();
                if (!success) {
                    showToast('Êú™ÊâæÂà∞Ëß£ÂØÜÁªìÊûúÔºåËØ∑Á®çÂêéÈáçËØï');
                    addLog('Êú™ÊâæÂà∞ÊúâÊïàÁöÑËß£ÂØÜÁªìÊûú', 'warning');
                }
            } catch (error) {
                addLog('Ëé∑ÂèñÁªìÊûúÂ§±Ë¥•: ' + error.message, 'error');
                showToast('Ëé∑ÂèñÁªìÊûúÂ§±Ë¥•');
            }
        }

        // Â§çÂà∂ÁªìÊûú
        function copyResult() {
            const output = document.getElementById('output');
            let content;
            
            // Â¶ÇÊûúÂåÖÂê´HTMLÊ†áÁ≠æÔºåÊèêÂèñÁ∫ØÊñáÊú¨
            if (output.innerHTML.includes('<span')) {
                content = stripHTMLTags(output.innerHTML);
            } else {
                content = output.textContent || output.innerText;
            }
            
            if (!content || content.includes('Ëß£ÂØÜÁªìÊûúÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå')) {
                showToast('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂÜÖÂÆπ');
                return;
            }
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(content).then(() => {
                    showToast('ÁªìÊûúÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                    addLog('Â§çÂà∂ÊàêÂäü', 'success');
                }).catch(() => {
                    fallbackCopy(content);
                });
            } else {
                fallbackCopy(content);
            }
        }

        // Â§áÁî®Â§çÂà∂ÊñπÊ≥ï
        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showToast('ÁªìÊûúÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                addLog('Â§çÂà∂ÊàêÂäü', 'success');
            } catch (err) {
                showToast('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
                addLog('Â§çÂà∂Â§±Ë¥•: ' + err.message, 'error');
            }
            
            document.body.removeChild(textArea);
        }

        // ‰∏ãËΩΩÁªìÊûú
        function downloadResult() {
            const output = document.getElementById('output');
            let content;
            
            // Â¶ÇÊûúÂåÖÂê´HTMLÊ†áÁ≠æÔºåÊèêÂèñÁ∫ØÊñáÊú¨
            if (output.innerHTML.includes('<span')) {
                content = stripHTMLTags(output.innerHTML);
            } else {
                content = output.textContent || output.innerText;
            }
            
            if (!content || content.includes('Ëß£ÂØÜÁªìÊûúÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå')) {
                showToast('Ê≤°ÊúâÂèØ‰∏ãËΩΩÁöÑÂÜÖÂÆπ');
                return;
            }
            
            try {
                const blob = new Blob([content], { type: 'text/javascript;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `decrypted_${Date.now()}.js`;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Êñá‰ª∂‰∏ãËΩΩÂ∑≤ÂºÄÂßã');
                addLog('‰∏ãËΩΩÊàêÂäü', 'success');
            } catch (error) {
                addLog('‰∏ãËΩΩÂ§±Ë¥•: ' + error.message, 'error');
                showToast('‰∏ãËΩΩÂ§±Ë¥•');
            }
        }

        // Ê∏ÖÈô§ÊâÄÊúâÂÜÖÂÆπ
        function clearAll() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÂÜÖÂÆπÂêóÔºü')) {
                document.getElementById('input').value = '';
                document.getElementById('remoteUrl').value = '';
                document.getElementById('output').innerHTML = '<span class="hljs-comment">// Ëß£ÂØÜÁªìÊûúÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå...</span>';
                document.getElementById('log').innerHTML = '';
                setProgress(0);
                
                showToast('ÊâÄÊúâÂÜÖÂÆπÂ∑≤Ê∏ÖÈô§');
                addLog('ÊâÄÊúâÂÜÖÂÆπÂ∑≤Ê∏ÖÈô§', 'info');
            }
        }

        // Ê∑ªÂä†ÈîÆÁõòÂø´Êç∑ÈîÆ
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter: ÂºÄÂßãËß£ÂØÜ
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                startDecrypt();
            }
            
            // Ctrl/Cmd + R: Ëé∑ÂèñÁªìÊûú
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                getResult();
            }
            
            // Ctrl/Cmd + C: Â§çÂà∂ÁªìÊûú (ÂΩìÁÑ¶ÁÇπ‰∏çÂú®ËæìÂÖ•Ê°ÜÊó∂)
            if ((e.ctrlKey || e.metaKey) && e.key === 'c' && !e.target.matches('input, textarea')) {
                e.preventDefault();
                copyResult();
            }
        });

        // ÊãñÊãΩ‰∏ä‰º†ÂäüËÉΩ
        const container = document.querySelector('.container');
        
        container.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.stopPropagation();
            container.style.background = 'linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%)';
        });
        
        container.addEventListener('dragleave', function(e) {
            e.preventDefault();
            e.stopPropagation();
            container.style.background = '';
        });
        
        container.addEventListener('drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
            container.style.background = '';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                addLog('ÊãñÊãΩÊñá‰ª∂: ' + file.name, 'info');
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('input').value = event.target.result;
                    addLog('Êñá‰ª∂ËØªÂèñÊàêÂäü', 'success');
                    showToast('Êñá‰ª∂Â∑≤Âä†ËΩΩ');
                };
                reader.onerror = function() {
                    addLog('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•', 'error');
                    showToast('Êñá‰ª∂ËØªÂèñÂ§±Ë¥•');
                };
                reader.readAsText(file);
            }
        });

        // Ëá™Âä®‰øùÂ≠òËæìÂÖ•ÂÜÖÂÆπ
        let saveTimer;
        document.getElementById('input').addEventListener('input', function() {
            clearTimeout(saveTimer);
            saveTimer = setTimeout(() => {
                localStorage.setItem('saved_input', this.value);
            }, 1000);
        });

        // ÊÅ¢Â§ç‰øùÂ≠òÁöÑËæìÂÖ•ÂÜÖÂÆπ
        window.addEventListener('load', function() {
            const savedInput = localStorage.getItem('saved_input');
            if (savedInput && !document.getElementById('input').value) {
                document.getElementById('input').value = savedInput;
                addLog('Â∑≤ÊÅ¢Â§ç‰∏äÊ¨°ÁöÑËæìÂÖ•ÂÜÖÂÆπ', 'info');
            }
        });
    </script>
</body>
</html>